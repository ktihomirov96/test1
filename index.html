
<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <title>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∏–∑–¥–µ–ª–∏—è</title>
  <style>
    body { margin: 0; font-family: sans-serif; display: flex; height: 100vh; }
    nav {
      width: 240px; background: #1e3a5f; color: white; padding: 20px; box-sizing: border-box;
    }
    nav h2 { margin-top: 0; font-size: 18px; }
    nav a {
      display: block; padding: 10px; color: white; text-decoration: none;
      border-radius: 4px; margin-bottom: 5px;
    }
    nav a.active, nav a:hover { background: #3b82f6; }
    main {
      flex: 1; background: #f3f4f6; padding: 20px; overflow-y: auto;
    }
    section { display: none; }
    section.active { display: block; }
    input, select, button {
      padding: 8px; margin: 5px 0; width: 100%;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    img { max-width: 60px; }
  </style>
</head>
<body>

<nav>
  <h2>üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∏–∑–¥–µ–ª–∏—è</h2>
  <a href="#" class="nav-link active" data-target="home">–ù–∞—á–∞–ª–æ</a>
  <a href="#" class="nav-link" data-target="offers">–û—Ñ–µ—Ä—Ç–∏ –∏ —Ä–µ–º–æ–Ω—Ç–∏</a>
  <a href="#" class="nav-link" data-target="warehouse">–°–∫–ª–∞–¥</a>
  <a href="#" class="nav-link" data-target="users">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</a>
</nav>

  
  <main>
    <section id="home" class="active">
      <h2>–ß–∞—Ç</h2>
      <input id="chatUsername" placeholder="–ò–º–µ">
      <input id="chatInput" placeholder="–°—ä–æ–±—â–µ–Ω–∏–µ">
      <button onclick="sendWS()">–ò–∑–ø—Ä–∞—Ç–∏</button>
      <div id="chatBox" style="height:200px; border:1px solid #ccc; overflow:auto; margin-top:10px;"></div>
    </section>
    <section id="offers">
      <h2>–î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –æ—Ñ–µ—Ä—Ç–∞</h2>
      <input id="project" placeholder="–ü—Ä–æ–µ–∫—Ç"><input id="matrixNo" placeholder="–ú–∞—Ç—Ä–∏—Ü–∞">
      <input id="client" placeholder="–ö–ª–∏–µ–Ω—Ç"><input id="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
      <input id="dueDate" type="date"><input id="price" placeholder="–¶–µ–Ω–∞">
      <input id="email" placeholder="Email"><select id="priority">
        <option>–ù–∏—Å–∫–∞</option><option>–°—Ä–µ–¥–Ω–∞</option><option>–í–∏—Å–æ–∫–∞</option></select>
      <input type="file" id="imageUpload">
<select id="status"><option>–≤ –ø—Ä–æ—Ü–µ—Å</option><option>–∑–∞–≤—ä—Ä—à–µ–Ω–∞</option></select><button onclick="submitOffer()">–ó–∞–ø–∞–∑–∏</button>
      
<div style="margin: 10px 0;">
  <input id="searchBox" type="text" placeholder="–¢—ä—Ä—Å–∏ –ø–æ –∫–ª–∏–µ–Ω—Ç –∏–ª–∏ –º–∞—Ç—Ä–∏—Ü–∞..." oninput="filterOffers()" style="padding: 6px; width: 300px; border: 1px solid #ccc; border-radius: 4px;">
</div>
<table><thead><tr><th>–ü—Ä–æ–µ–∫—Ç</th><th>–ú–∞—Ç—Ä–∏—Ü–∞</th><th>–ö–ª–∏–µ–Ω—Ç</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–î–∞—Ç–∞ –Ω–∞ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ</th><th>–¶–µ–Ω–∞</th><th>–°—Ä–æ–∫ –æ—Ç –¥–æ—Å—Ç–∞–≤—á–∏–∫</th><th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th><th>–°—Ç–∞—Ç—É—Å</th><th>–°–Ω–∏–º–∫–∞</th></tr><th>–î–µ–π—Å—Ç–≤–∏—è</th></thead>
      <tbody id="offersTable"></tbody></table>
    </section>
    <section id="warehouse">
      <h2>–°–∫–ª–∞–¥</h2>
      <input id="stockMatrix" placeholder="–ú–∞—Ç—Ä–∏—Ü–∞">
      <input id="stockDeadline" type="date">
      <button onclick="addStock()">–î–æ–±–∞–≤–∏</button>
      
<div style="margin: 10px 0;">
  <input id="stockSearch" type="text" placeholder="–¢—ä—Ä—Å–∏ –ø–æ –º–∞—Ç—Ä–∏—Ü–∞..." oninput="filterStock()" style="padding: 6px; width: 300px; border-radius: 4px; border: 1px solid #ccc;">
</div>
<ul id="stockList"></ul>
    </section>
    <section id="users">
      <h2>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</h2>
      <p>‚úì –í–∏–µ —Å—Ç–µ –æ–Ω–ª–∞–π–Ω</p>
    </section>
  </main>
  





<script>
document.querySelectorAll('.nav-link').forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const target = link.getAttribute('data-target');
    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.getElementById(target).classList.add('active');
    link.classList.add('active');
  });
});

function loadOffers() {
  fetch("/api/offers").then(res => res.json()).then(data => {
    const tbody = document.querySelector("#offers table tbody");
    tbody.innerHTML = "";
    data.forEach(o => {
      let color = o.priority === "–í–∏—Å–æ–∫–∞" ? "#f87171" : o.priority === "–°—Ä–µ–¥–Ω–∞" ? "#facc15" : "#34d399";
      let statusColor = o.status === "–∑–∞–≤—ä—Ä—à–µ–Ω–∞" ? "#4ade80" : "#facc15";
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${o.project}</td><td>${o.matrixNo}</td><td>${o.client}</td>
        <td>${o.description}</td><td>${o.dueDate}</td><td>${o.price}</td>
        <td>${o.email}</td><td style="background:${color}">${o.priority}</td>
        <td style="background:${statusColor}">${o.status}</td><td><img src="${o.image}" /></td>`;
      tbody.appendChild(row);
    });
  });
}

function submitOffer() {
  const file = imageUpload.files[0];
  const reader = new FileReader();
  const offer = {
    project: project.value,
    matrixNo: matrixNo.value,
    client: client.value,
    description: description.value,
    dueDate: dueDate.value,
    price: price.value,
    email: email.value,
    priority: priority.value,
    status: status.value,
    image: ""
  };
  if (file) {
    reader.onload = function(e) {
      offer.image = e.target.result;
      sendOffer(offer);
    };
    reader.readAsDataURL(file);
  } else {
    sendOffer(offer);
  }
}

function sendOffer(data) {
  fetch("/api/offers", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  }).then(() => {
    loadOffers();
    project.value = matrixNo.value = client.value = description.value = dueDate.value = price.value = email.value = "";
    priority.value = "–ù–∏—Å–∫–∞";
    status.value = "–≤ –ø—Ä–æ—Ü–µ—Å";
    imageUpload.value = "";
  });
}

function addStock() {
  const m = document.getElementById("stockMatrix").value;
  const d = document.getElementById("stockDeadline").value;
  if (!m || !d) return;
  const now = new Date(), end = new Date(d);
  const days = Math.ceil((end - now)/(1000*60*60*24));
  let color = "#34d399"; if (days <= 7) color = "#facc15"; if (days <= 3) color = "#f87171";
  const li = document.createElement("li");
  li.style.background = color;
  li.textContent = `–ú–∞—Ç—Ä–∏—Ü–∞ ${m} ‚Äì –ö—Ä–∞–µ–Ω —Å—Ä–æ–∫: ${d} (${days} –¥–Ω–∏)`;
  document.getElementById("stockList").appendChild(li);
}

const proto = location.protocol === "https:" ? "wss" : "ws";
const host = location.hostname === "localhost" ? "localhost:3000" : location.host;
const ws = new WebSocket(proto + "://" + host);
ws.onmessage = e => {
  const m = JSON.parse(e.data);
  const box = document.getElementById("chatBox");
  if (box) box.innerHTML += m.timestamp.slice(11,16) + " ‚Äì " + m.username + ": " + m.text + "<br>";
};
function sendWS() {
  const u = document.getElementById("chatUsername").value;
  const t = document.getElementById("chatInput").value;
  if (u && t) ws.send(JSON.stringify({ username: u, text: t }));
  document.getElementById("chatInput").value = "";
}

function filterOffers() {
  const term = document.getElementById("searchBox")?.value.toLowerCase();
  const rows = document.querySelectorAll("#offers table tbody tr");
  rows.forEach(row => {
    const matrix = row.children[1]?.textContent.toLowerCase() || "";
    const client = row.children[2]?.textContent.toLowerCase() || "";
    row.style.display = (matrix.includes(term) || client.includes(term)) ? "" : "none";
  });
}

function filterStock() {
  const term = document.getElementById("stockSearch")?.value.toLowerCase();
  const items = document.querySelectorAll("#stockList li");
  items.forEach(li => {
    li.style.display = li.textContent.toLowerCase().includes(term) ? "" : "none";
  });
}

window.onload = loadOffers;
</script>

</body>
</html>


