
<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <title>Технически изделия</title>
  <style>
    body { font-family: sans-serif; margin: 0; display: flex; }
    nav { width: 200px; background: #1e3a5f; color: white; height: 100vh; padding: 10px; }
    nav a { display: block; padding: 10px; color: white; text-decoration: none; }
    nav a.active { background: #3b82f6; }
    main { flex: 1; padding: 20px; }
    .section { display: none; }
    .section.active { display: block; }
  </style>
</head>
<body onload="initApp()">
  <nav>
    <a href="#" class="nav-link active" data-section="home">Начало</a>
    <a href="#" class="nav-link" data-section="offers">Оферти и ремонти</a>
    <a href="#" class="nav-link" data-section="warehouse">Склад</a>
    <a href="#" class="nav-link" data-section="users">Потребители</a>
  </nav>
  <main>
    <div id="home" class="section active">
      <h1>Чат</h1>
      <input id="chatUsername" placeholder="Вашето име">
      <div id="chatBox" style="height:200px; overflow:auto; border:1px solid #ccc; margin:10px 0; padding:10px;"></div>
      <input id="chatInput" placeholder="Съобщение">
      <button onclick="sendWS()">Изпрати</button>
    </div>
    <div id="offers" class="section">
      <h1>Оферти и ремонти</h1>
      <p>Тук ще има оферти...</p>
    </div>
    <div id="warehouse" class="section">
      <h1>Склад</h1>
      <p>Управление на склад...</p>
    </div>
    <div id="users" class="section">
      <h1>Потребители</h1>
      <p>Само логнати потребители се виждат тук...</p>
    </div>
  </main>
  <script>
    let activeTab = "home";
    function initApp() {
      document.querySelectorAll(".nav-link").forEach(link => {
        link.addEventListener("click", e => {
          e.preventDefault();
          const target = link.getAttribute("data-section");
          document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
          document.querySelector(`#${target}`).classList.add("active");
          document.querySelectorAll(".nav-link").forEach(l => l.classList.remove("active"));
          link.classList.add("active");
          activeTab = target;
        });
      });
      setupWS();
    }

    let ws;
    function setupWS() {
      ws = new WebSocket("wss://" + window.location.host);
      ws.onmessage = function(event) {
        const msg = JSON.parse(event.data);
        const box = document.getElementById("chatBox");
        const div = document.createElement("div");
        div.textContent = msg.timestamp.slice(11,16) + " – " + msg.username + ": " + msg.text;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
        playNotification(msg.username);
      };
    }

    function sendWS() {
      const name = document.getElementById("chatUsername").value;
      const input = document.getElementById("chatInput");
      if (!name || !input.value) return;
      ws.send(JSON.stringify({ username: name, text: input.value }));
      input.value = "";
    }

    function playNotification(sender) {
      const currentUser = document.getElementById("chatUsername").value;
      if (sender !== currentUser) {
        const audio = new Audio("https://notificationsounds.com/storage/sounds/file-sounds-1156-pristine.mp3");
        audio.volume = 0.5;
        audio.play().catch(() => {});
      }
    }
  
function deleteOffer(id) {
  if (!confirm("Сигурни ли сте, че искате да изтриете тази оферта?")) return;
  fetch("/api/offers/" + id, {
    method: "DELETE"
  }).then(() => loadOffers());
}

let 
editingId = null;
document.getElementById("successMsg").style.display = "block";
setTimeout(() => {
  document.getElementById("successMsg").style.display = "none";
}, 3000);

function editOffer(offer) {
  editingId = offer.id;
  document.getElementById("project").value = offer.project;
  document.getElementById("matrixNo").value = offer.matrixNo;
  document.getElementById("client").value = offer.client;
  document.getElementById("desc").value = offer.description;
  document.getElementById("date").value = offer.dueDate;
  document.getElementById("price").value = offer.price;
  document.getElementById("email").value = offer.email;
  document.getElementById("priority").value = offer.priority;
  window.scrollTo(0, 0);
}

function sendOffer(data) {
  const method = editingId ? "PUT" : "POST";
  const url = editingId ? "/api/offers/" + editingId : "/api/offers";
  fetch(url, {
    method,
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(data)
  }).then(() => {
    loadOffers();
    
editingId = null;
document.getElementById("successMsg").style.display = "block";
setTimeout(() => {
  document.getElementById("successMsg").style.display = "none";
}, 3000);

    document.querySelectorAll("#offers input, #offers select").forEach(el => el.value = "");
  });
}
</script>
</body>
</html>
