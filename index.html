
<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <title>Оферти с база данни</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button { margin: 5px; padding: 6px; width: 250px; }
    table { margin-top: 20px; border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; }
  </style>
</head>
<body>
  <h2>Добавяне на оферта</h2>
  <form id="offerForm">
    <input name="project" placeholder="Проект №"><br>
    <input name="client" placeholder="Клиент"><br>
    <input name="description" placeholder="Описание"><br>
    <input name="deadline" type="date"><br>
    <input name="price" placeholder="Цена"><br>
    <button type="submit">Добави оферта</button>
  </form>

  <h3>Списък с оферти:</h3>
  <table id="offersTable">
    <tr><th>Проект</th><th>Клиент</th><th>Описание</th><th>Срок</th><th>Цена</th></tr>
  </table>

<script>
function loadOffers() {
  fetch('/offers')
    .then(res => res.json())
    .then(data => {
      const table = document.getElementById('offersTable');
      table.innerHTML = "<tr><th>Проект</th><th>Клиент</th><th>Описание</th><th>Срок</th><th>Цена</th></tr>" +
        data.map(o => `<tr><td>${o.project}</td><td>${o.client}</td><td>${o.description}</td><td>${o.deadline}</td><td>${o.price}</td></tr>`).join('');
    });
}

document.getElementById('offerForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const form = new FormData(this);
  const data = Object.fromEntries(form.entries());
  await fetch('/add-offer', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });
  this.reset();
  loadOffers();
});

loadOffers();
</script>
</body>
</html>
