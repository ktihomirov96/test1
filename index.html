<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <title>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∏–∑–¥–µ–ª–∏—è</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #f9fafb;
    }
    .container { display: flex; }
    .sidebar {
      width: 250px;
      background-color: #1f2937;
      color: white;
      height: 100vh;
      padding: 20px;
      position: fixed;
    }
    .sidebar h2 { font-size: 18px; margin-bottom: 30px; }
    .sidebar a {
      display: block;
      color: white;
      text-decoration: none;
      margin: 12px 0;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
    }
    .sidebar a:hover,
    .sidebar a.active { background-color: #374151; }
    .main {
      margin-left: 270px;
      padding: 40px;
      width: calc(100% - 270px);
    }
    .hidden { display: none; }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 30px;
    }

    th, td {
      padding: 12px 16px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
    }

    th {
      background-color: #f3f4f6;
      font-weight: bold;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    input, select, button {
      padding: 10px;
      margin: 5px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: 100%;
    }

    .btn {
      background: #1f2937;
      color: white;
      border: none;
      cursor: pointer;
      width: auto;
    }

    .btn.red { background: darkred; }

    .online-users {
      list-style: none;
      padding: 0;
    }

    .online-users li::before {
      content: "üü¢ ";
    }
  </style>
</head>


<body onload="checkLogin(); loadOffers()">

<script>
function checkLogin() {
  if (sessionStorage.getItem("loggedIn") !== "true") {
    window.location.href = "login.html";
  }
}
</script>

  <div class="container">
    <div class="sidebar">
      <h2>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∏–∑–¥–µ–ª–∏—è</h2>
      <a href="#" class="nav" data-target="home">–ù–∞—á–∞–ª–æ</a>
      <a href="#" class="nav" data-target="offers">–û—Ñ–µ—Ä—Ç–∏ –∏ —Ä–µ–º–æ–Ω—Ç–∏</a>
      <a href="#" class="nav" data-target="stock">–°–∫–ª–∞–¥</a>
      <a href="#" class="nav" data-target="users">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</a>
<a href="#" class="nav" data-target="notifications">–ò–∑–≤–µ—Å—Ç–∏—è</a>
    </div>
    <div class="main">
      

<div id="home">
  <h2>–ß–∞—Ç –º–µ–∂–¥—É –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</h2>
  <div class="card">
    <input id="chatUsername" placeholder="–í–∞—à–µ—Ç–æ –∏–º–µ">
    <div id="chatBox" style="margin-top:10px; max-height:300px; overflow:auto; background:#f1f1f1; padding:10px; border-radius:8px;"></div>
    <input id="chatInput" placeholder="–í—ä–≤–µ–¥–∏ —Å—ä–æ–±—â–µ–Ω–∏–µ">
    <button class="btn" onclick="sendWS()">–ò–∑–ø—Ä–∞—Ç–∏</button>
  </div>
</div>
<div id="offers"
 class="hidden">
  <h2>–î–æ–±–∞–≤–∏ –æ—Ñ–µ—Ä—Ç–∞</h2>
  <div class="card">
    <input id="project" placeholder="–ü—Ä–æ–µ–∫—Ç ‚Ññ">
    <input id="matrixNo" placeholder="–ù–æ–º–µ—Ä –Ω–∞ –º–∞—Ç—Ä–∏—Ü–∞">
    <input id="client" placeholder="–ö–ª–∏–µ–Ω—Ç">
    <input id="desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
    <input id="date" type="date" placeholder="–°—Ä–æ–∫">
    <input id="price" placeholder="–¶–µ–Ω–∞">
    <input id="email" placeholder="Email">
    <select id="priority">
      <option>–í–∏—Å–æ–∫–∞</option>
      <option>–°—Ä–µ–¥–Ω–∞</option>
      <option>–ù–∏—Å–∫–∞</option>
    </select>
    <input id="imageUpload" type="file" accept="image/*">
    <button class="btn" onclick="addOffer()">–î–æ–±–∞–≤–∏ –æ—Ñ–µ—Ä—Ç–∞</button>
  </div>
  
<div class="card">
  <input id="searchInput" placeholder="–¢—ä—Ä—Å–∏ –ø–æ –∫–ª–∏–µ–Ω—Ç –∏–ª–∏ –º–∞—Ç—Ä–∏—Ü–∞..." onkeyup="filterOffers()">
</div>
<table>
    <thead>
      <tr>
        <th>–ü—Ä–æ–µ–∫—Ç</th>
        <th>–ú–∞—Ç—Ä–∏—Ü–∞</th>
        <th>–ö–ª–∏–µ–Ω—Ç</th>
        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
        <th>–°—Ä–æ–∫</th>
        <th>–¶–µ–Ω–∞</th>
        <th>Email</th>
        <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
        <th>–°–Ω–∏–º–∫–∞</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody id="offerTable"></tbody>
  </table>
</div>

<div id="stock" class="hidden">
        <h2>–°–∫–ª–∞–¥</h2>
        <div class="card">
          <input id="matrix" placeholder="–ù–æ–º–µ—Ä –Ω–∞ –º–∞—Ç—Ä–∏—Ü–∞">
          <input id="quantity" type="number" placeholder="–ë—Ä–æ–π–∫–∞">
          <button class="btn" onclick="addStock()">–î–æ–±–∞–≤–∏ –≤ —Å–∫–ª–∞–¥–∞</button>
          <ul id="stockList"></ul>
        </div>
      </div>

      
<div id="notifications" class="hidden">
  <h2>–û—Ñ–µ—Ä—Ç–∏ —Å—ä—Å —Å—Ä–æ–∫ —Å–ª–µ–¥ 3 –¥–Ω–∏</h2>
  <table>
    <thead>
      <tr>
        <th>–ü—Ä–æ–µ–∫—Ç</th>
        <th>Email</th>
        <th>–ö—Ä–∞–µ–Ω —Å—Ä–æ–∫</th>
      </tr>
    </thead>
    <tbody id="notifyTable"></tbody>
  </table>
</div>

<div id="users" class="hidden">
        <h2>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –Ω–∞ –ª–∏–Ω–∏—è</h2>
        <div class="card">
          <ul class="online-users">
            <li>admin</li>
            <li>ivan</li>
            <li>maria</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

<script>
  document.querySelectorAll('.nav').forEach(link => {
    link.addEventListener('click', function () {
      const id = this.getAttribute('data-target');
      document.querySelectorAll('.main > div').forEach(div => div.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      document.querySelectorAll('.nav').forEach(a => a.classList.remove('active'));
      this.classList.add('active');
    });
  });

  


function addOffer() {
    const project = document.getElementById("project");
    const matrixNo = document.getElementById("matrixNo");
    const client = document.getElementById("client");
    const desc = document.getElementById("desc");
    const date = document.getElementById("date");
    const price = document.getElementById("price");
    const email = document.getElementById("email");
    const priority = document.getElementById("priority");
    const imageUpload = document.getElementById("imageUpload");

    const today = new Date();
    const dueDate = new Date(date.value);
    const diffTime = dueDate - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    const table = document.getElementById('offerTable');
    const row = document.createElement('tr');
    let color = 'gray';
    if (priority.value === '–í–∏—Å–æ–∫–∞') color = 'red';
    else if (priority.value === '–°—Ä–µ–¥–Ω–∞') color = 'orange';
    else if (priority.value === '–ù–∏—Å–∫–∞') color = 'green';

    const imgID = "img" + Date.now();

    row.innerHTML = `
      <td>${project.value}</td>
      <td>${matrixNo.value}</td>
      <td>${client.value}</td>
      <td>${desc.value}</td>
      <td>${date.value}</td>
      <td>${price.value}</td>
      <td>${email.value}</td>
      <td style="color:${color}; font-weight:bold;">${priority.value}</td>
      <td><img src="#" id="${imgID}" width="60" style="border-radius:8px;" /></td>
      <td>
        <button class="btn" onclick="editOffer(this)">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
        <button class="btn red" onclick="this.closest('tr').remove()">–ò–∑—Ç—Ä–∏–π</button>
      </td>`;

    table.appendChild(row);

    const file = imageUpload.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById(imgID).src = e.target.result;
      }
      reader.readAsDataURL(file);
    }

    if (diffDays === 3) {
      const notifyTable = document.getElementById("notifyTable");
      const nrow = document.createElement("tr");
      nrow.innerHTML = `
        <td>${project.value}</td>
        <td>${email.value}</td>
        <td>${date.value}</td>
      `;
      notifyTable.appendChild(nrow);
    }

    project.value = "";
    matrixNo.value = "";
    client.value = "";
    desc.value = "";
    date.value = "";
    price.value = "";
    email.value = "";
    priority.value = "–°—Ä–µ–¥–Ω–∞";
    imageUpload.value = "";
}

    matrixNo.value = "";
    client.value = "";
    desc.value = "";
    date.value = "";
    price.value = "";
    email.value = "";
    priority.value = "–°—Ä–µ–¥–Ω–∞";
    imageUpload.value = "";
}

    const table = document.getElementById('offerTable');
    const row = document.createElement('tr');
    let color = 'gray';
    if (priority.value === '–í–∏—Å–æ–∫–∞') color = 'red';
    else if (priority.value === '–°—Ä–µ–¥–Ω–∞') color = 'orange';
    else if (priority.value === '–ù–∏—Å–∫–∞') color = 'green';

    const imgID = "img" + Date.now();

    row.innerHTML = `
      <td>${project.value}</td>
      <td>${matrixNo.value}</td>
      <td>${client.value}</td>
      <td>${desc.value}</td>
      <td>${date.value}</td>
      <td>${price.value}</td>
      <td>${email.value}</td>
      <td style="color:${color}; font-weight:bold;">${priority.value}</td>
      <td><img src="#" id="${imgID}" width="60" style="border-radius:8px;" /></td>
      <td>
        <button class="btn" onclick="editOffer(this)">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
        <button class="btn red" onclick="this.closest('tr').remove()">–ò–∑—Ç—Ä–∏–π</button>
      </td>`;

    table.appendChild(row);

    const file = document.getElementById("imageUpload").files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById(imgID).src = e.target.result;
      }
      reader.readAsDataURL(file);
    }
}

    const table = document.getElementById('offerTable');
    const row = document.createElement('tr');
    let color = 'gray';
    if (priority.value === '–í–∏—Å–æ–∫–∞') color = 'red';
    else if (priority.value === '–°—Ä–µ–¥–Ω–∞') color = 'orange';
    else if (priority.value === '–ù–∏—Å–∫–∞') color = 'green';

    row.innerHTML = `
      <td>${project.value}</td>
      <td>${matrixNo.value}</td><td>${client.value}</td><td>${desc.value}</td><td>${date.value}</td><td><img src="#" id="img${Date.now()}" width="60" style="border-radius:8px;" /></td>
      <td>${desc.value}</td>
      <td>${date.value}</td>
      
      
      
      <td>
        <button class="btn" onclick="editOffer(this)">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
        <button class="btn red" onclick="this.closest('tr').remove()">–ò–∑—Ç—Ä–∏–π</button>
      </td>`;
    
    table.appendChild(row);
    const file = document.getElementById("imageUpload").files[0];
    if (file) {
      const reader = new FileReader();
      const imgID = row.querySelector("img").id;
      reader.onload = function(e) {
        document.getElementById(imgID).src = e.target.result;
      }
      reader.readAsDataURL(file);
    }
    
  }

  function addStock() {
    const list = document.getElementById('stockList');
    const item = document.createElement('li');
    item.textContent = `${matrix.value}: ${quantity.value} –±—Ä.`;
    list.appendChild(item);
  }

  
function sendMessage() {
  const input = document.getElementById("chatInput");
  const box = document.getElementById("chatBox");
  if (input.value.trim() !== "") {
    const msg = document.createElement("div");
    msg.textContent = "üë§ " + input.value;
    msg.style.margin = "5px 0";
    msg.style.padding = "8px";
    msg.style.background = "#e5e7eb";
    msg.style.borderRadius = "8px";
    box.appendChild(msg);
    input.value = "";
  }
}

function editOffer(btn) {
    alert("–†–µ–¥–∞–∫—Ü–∏—è ‚Äì –≤ –ø—ä–ª–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —â–µ –æ—Ç–≤–∞—Ä—è —Ñ–æ—Ä–º–∞ —Å –¥–∞–Ω–Ω–∏—Ç–µ.");
  }
</script>

<!-- –ú–æ–¥–∞–ª–µ–Ω –ø—Ä–æ–∑–æ—Ä–µ—Ü –∑–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è -->
<div id="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:9999;">
  <img id="modalImg" src="" style="max-width:90%; max-height:90%; border:5px solid white; border-radius:12px;">
</div>

<script>
  // –ê–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –º–æ–¥–∞–ª –ø—Ä–∏ –∫–ª–∏–∫ –Ω–∞ —Å–Ω–∏–º–∫–∞
  document.addEventListener("click", function(e) {
    if (e.target.tagName === "IMG" && e.target.closest("td")) {
      const modal = document.getElementById("modal");
      const modalImg = document.getElementById("modalImg");
      modal.style.display = "flex";
      modalImg.src = e.target.src;
    }
    if (e.target.id === "modal") {
      document.getElementById("modal").style.display = "none";
    }
  });
</script>

<script>
document.querySelectorAll('.nav').forEach(link => {
  link.addEventListener('click', function (e) {
    e.preventDefault();
    const id = this.getAttribute('data-target');
    document.querySelectorAll('.main > div').forEach(div => div.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    document.querySelectorAll('.nav').forEach(a => a.classList.remove('active'));
    this.classList.add('active');
  });
});

function sendMessage() {
  const input = document.getElementById("chatInput");
  const box = document.getElementById("chatBox");
  if (input && input.value.trim() !== "") {
    const msg = document.createElement("div");
    msg.textContent = "üë§ " + input.value;
    msg.style.margin = "5px 0";
    msg.style.padding = "8px";
    msg.style.background = "#e5e7eb";
    msg.style.borderRadius = "8px";
    box.appendChild(msg);
    input.value = "";
  }
}

function addOffer() {
  const project = document.getElementById("project");
  const matrixNo = document.getElementById("matrixNo");
  const client = document.getElementById("client");
  const desc = document.getElementById("desc");
  const date = document.getElementById("date");
  const price = document.getElementById("price");
  const email = document.getElementById("email");
  const priority = document.getElementById("priority");
  const imageUpload = document.getElementById("imageUpload");

  const today = new Date();
  const dueDate = new Date(date.value);
  const diffTime = dueDate - today;
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

  const table = document.getElementById('offerTable');
  const row = document.createElement('tr');
  let color = 'gray';
  if (priority.value === '–í–∏—Å–æ–∫–∞') color = 'red';
  else if (priority.value === '–°—Ä–µ–¥–Ω–∞') color = 'orange';
  else if (priority.value === '–ù–∏—Å–∫–∞') color = 'green';

  const imgID = "img" + Date.now();

  row.innerHTML = `
    <td>${project.value}</td>
    <td>${matrixNo.value}</td>
    <td>${client.value}</td>
    <td>${desc.value}</td>
    <td>${date.value}</td>
    <td>${price.value}</td>
    <td>${email.value}</td>
    <td style="color:${color}; font-weight:bold;">${priority.value}</td>
    <td><img src="#" id="${imgID}" width="60" style="border-radius:8px;" /></td>
    <td>
      <button class="btn" onclick="editOffer(this)">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
      <button class="btn red" onclick="this.closest('tr').remove()">–ò–∑—Ç—Ä–∏–π</button>
    </td>`;

  table.appendChild(row);

  const file = imageUpload.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById(imgID).src = e.target.result;
    }
    reader.readAsDataURL(file);
  }

  if (diffDays === 3) {
    const notifyTable = document.getElementById("notifyTable");
    const nrow = document.createElement("tr");
    nrow.innerHTML = `
      <td>${project.value}</td>
      <td>${email.value}</td>
      <td>${date.value}</td>
    `;
    notifyTable.appendChild(nrow);
  }

  project.value = "";
  matrixNo.value = "";
  client.value = "";
  desc.value = "";
  date.value = "";
  price.value = "";
  email.value = "";
  priority.value = "–°—Ä–µ–¥–Ω–∞";
  imageUpload.value = "";
}

function editOffer(btn) {
  alert("–†–µ–¥–∞–∫—Ü–∏—è—Ç–∞ –µ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–∞. –ú–æ–ª—è –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –Ω–æ–≤–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç —á—Ä–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∞.");
}

function addStock() {
  const matrix = document.getElementById("matrix");
  const quantity = document.getElementById("quantity");
  const list = document.getElementById('stockList');
  const item = document.createElement('li');
  item.textContent = `${matrix.value}: ${quantity.value} –±—Ä.`;
  list.appendChild(item);
  matrix.value = "";
  quantity.value = "";
}
</script>

<script>
function filterOffers() {
  const input = document.getElementById("searchInput").value.toLowerCase();
  const rows = document.querySelectorAll("#offerTable tr");

  rows.forEach(row => {
    const cells = row.querySelectorAll("td");
    if (cells.length >= 3) {
      const matrix = cells[1].textContent.toLowerCase();
      const client = cells[2].textContent.toLowerCase();
      if (matrix.includes(input) || client.includes(input)) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    }
  });
}
</script>
</body>


</html>

<script>
document.querySelectorAll('.nav').forEach(link => {
  link.addEventListener('click', function (e) {
    e.preventDefault();
    const id = this.getAttribute('data-target');
    document.querySelectorAll('.main > div').forEach(div => div.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    document.querySelectorAll('.nav').forEach(a => a.classList.remove('active'));
    this.classList.add('active');
  });
});
</script>

<script>
document.querySelectorAll('.nav').forEach(link => {
  link.addEventListener('click', function (e) {
    e.preventDefault();
    const id = this.getAttribute('data-target');
    document.querySelectorAll('.main > div').forEach(div => div.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    document.querySelectorAll('.nav').forEach(a => a.classList.remove('active'));
    this.classList.add('active');
  });
});

function sendMessage() {
  const input = document.getElementById("chatInput");
  const box = document.getElementById("chatBox");
  if (input && input.value.trim() !== "") {
    const msg = document.createElement("div");
    msg.textContent = "üë§ " + input.value;
    msg.style.margin = "5px 0";
    msg.style.padding = "8px";
    msg.style.background = "#e5e7eb";
    msg.style.borderRadius = "8px";
    box.appendChild(msg);
    input.value = "";
  }
}



function addOffer() {
    const project = document.getElementById("project");
    const matrixNo = document.getElementById("matrixNo");
    const client = document.getElementById("client");
    const desc = document.getElementById("desc");
    const date = document.getElementById("date");
    const price = document.getElementById("price");
    const email = document.getElementById("email");
    const priority = document.getElementById("priority");
    const imageUpload = document.getElementById("imageUpload");

    const today = new Date();
    const dueDate = new Date(date.value);
    const diffTime = dueDate - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    const table = document.getElementById('offerTable');
    const row = document.createElement('tr');
    let color = 'gray';
    if (priority.value === '–í–∏—Å–æ–∫–∞') color = 'red';
    else if (priority.value === '–°—Ä–µ–¥–Ω–∞') color = 'orange';
    else if (priority.value === '–ù–∏—Å–∫–∞') color = 'green';

    const imgID = "img" + Date.now();

    row.innerHTML = `
      <td>${project.value}</td>
      <td>${matrixNo.value}</td>
      <td>${client.value}</td>
      <td>${desc.value}</td>
      <td>${date.value}</td>
      <td>${price.value}</td>
      <td>${email.value}</td>
      <td style="color:${color}; font-weight:bold;">${priority.value}</td>
      <td><img src="#" id="${imgID}" width="60" style="border-radius:8px;" /></td>
      <td>
        <button class="btn" onclick="editOffer(this)">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
        <button class="btn red" onclick="this.closest('tr').remove()">–ò–∑—Ç—Ä–∏–π</button>
      </td>`;

    table.appendChild(row);

    const file = imageUpload.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById(imgID).src = e.target.result;
      }
      reader.readAsDataURL(file);
    }

    if (diffDays === 3) {
      const notifyTable = document.getElementById("notifyTable");
      const nrow = document.createElement("tr");
      nrow.innerHTML = `
        <td>${project.value}</td>
        <td>${email.value}</td>
        <td>${date.value}</td>
      `;
      notifyTable.appendChild(nrow);
    }

    project.value = "";
    matrixNo.value = "";
    client.value = "";
    desc.value = "";
    date.value = "";
    price.value = "";
    email.value = "";
    priority.value = "–°—Ä–µ–¥–Ω–∞";
    imageUpload.value = "";
}

    matrixNo.value = "";
    client.value = "";
    desc.value = "";
    date.value = "";
    price.value = "";
    email.value = "";
    priority.value = "–°—Ä–µ–¥–Ω–∞";
    imageUpload.value = "";
}

    const table = document.getElementById('offerTable');
    const row = document.createElement('tr');
    let color = 'gray';
    if (priority.value === '–í–∏—Å–æ–∫–∞') color = 'red';
    else if (priority.value === '–°—Ä–µ–¥–Ω–∞') color = 'orange';
    else if (priority.value === '–ù–∏—Å–∫–∞') color = 'green';

    const imgID = "img" + Date.now();

    row.innerHTML = `
      <td>${project.value}</td>
      <td>${matrixNo.value}</td>
      <td>${client.value}</td>
      <td>${desc.value}</td>
      <td>${date.value}</td>
      <td>${price.value}</td>
      <td>${email.value}</td>
      <td style="color:${color}; font-weight:bold;">${priority.value}</td>
      <td><img src="#" id="${imgID}" width="60" style="border-radius:8px;" /></td>
      <td>
        <button class="btn" onclick="editOffer(this)">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
        <button class="btn red" onclick="this.closest('tr').remove()">–ò–∑—Ç—Ä–∏–π</button>
      </td>`;

    table.appendChild(row);

    const file = document.getElementById("imageUpload").files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById(imgID).src = e.target.result;
      }
      reader.readAsDataURL(file);
    }

    project.value = "";
    matrixNo.value = "";
    client.value = "";
    desc.value = "";
    date.value = "";
    price.value = "";
    email.value = "";
    priority.value = "–°—Ä–µ–¥–Ω–∞";
    imageUpload.value = "";
}

function addStock() {
  const matrix = document.getElementById("matrix");
  const quantity = document.getElementById("quantity");
  const list = document.getElementById('stockList');
  const item = document.createElement('li');
  item.textContent = `${matrix.value}: ${quantity.value} –±—Ä.`;
  list.appendChild(item);
  matrix.value = "";
  quantity.value = "";
}

function editOffer(btn) {
  alert("–†–µ–¥–∞–∫—Ü–∏—è—Ç–∞ –µ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–∞. –ü–æ–ø—ä–ª–Ω–µ—Ç–µ –Ω–æ–≤–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç —á—Ä–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∞.");
}
</script>

<script>
function loadOffers() {
  fetch("/api/offers")
    .then(res => res.json())
    .then(data => {
      const table = document.getElementById('offerTable');
      table.innerHTML = '';
      data.forEach(o => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${o.project}</td>
          <td>${o.matrixNo}</td>
          <td>${o.client}</td>
          <td>${o.description}</td>
          <td>${o.dueDate}</td>
          <td>${o.price}</td>
          <td>${o.email}</td>
          <td style="color:${getPriorityColor(o.priority)}; font-weight:bold;">${o.priority}</td>
          <td><img src="${o.image}" width="60" style="border-radius:8px;" /></td>
          <td>
            <button class="btn" onclick="editOffer(this)">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
            <button class="btn red" onclick="this.closest('tr').remove()">–ò–∑—Ç—Ä–∏–π</button>
          </td>`;
        table.appendChild(row);
      });
    });
}

function getPriorityColor(priority) {
  if (priority === "–í–∏—Å–æ–∫–∞") return "red";
  if (priority === "–°—Ä–µ–¥–Ω–∞") return "orange";
  if (priority === "–ù–∏—Å–∫–∞") return "green";
  return "gray";
}

// –ü—Ä–æ–º–µ–Ω—è–º–µ addOffer –∑–∞ –¥–∞ POST-–≤–∞
function addOffer() {
  const project = document.getElementById("project").value;
  const matrixNo = document.getElementById("matrixNo").value;
  const client = document.getElementById("client").value;
  const description = document.getElementById("desc").value;
  const dueDate = document.getElementById("date").value;
  const price = document.getElementById("price").value;
  const email = document.getElementById("email").value;
  const priority = document.getElementById("priority").value;
  const imageUpload = document.getElementById("imageUpload");

  let reader = new FileReader();
  const file = imageUpload.files[0];

  reader.onload = function(e) {
    const image = file ? e.target.result : "";

    fetch("/api/offers", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        project, matrixNo, client, description, dueDate, price, email, priority, image
      })
    }).then(() => {
      loadOffers(); // –ü—Ä–µ–∑–∞—Ä–µ–∂–¥–∞ —Ç–∞–±–ª–∏—Ü–∞—Ç–∞
    });
  };

  if (file) reader.readAsDataURL(file);
  else reader.onload(); // –ü—Ä–∞–∑–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

  document.getElementById("project").value = "";
  document.getElementById("matrixNo").value = "";
  document.getElementById("client").value = "";
  document.getElementById("desc").value = "";
  document.getElementById("date").value = "";
  document.getElementById("price").value = "";
  document.getElementById("email").value = "";
  document.getElementById("priority").value = "–°—Ä–µ–¥–Ω–∞";
  document.getElementById("imageUpload").value = "";
}
</script>
</html>

<script>
let ws;
function setupWS() {
  ws = new WebSocket("wss://" + window.location.host);
  ws.onmessage = function(event) {
    const msg = JSON.parse(event.data);
    const box = document.getElementById("chatBox");
    const div = document.createElement("div");
    div.textContent = msg.timestamp.slice(11,16) + " ‚Äì " + msg.username + ": " + msg.text;
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
  };
}

function sendWS() {
  const name = document.getElementById("chatUsername").value;
  const input = document.getElementById("chatInput");
  if (!name || !input.value) return;
  ws.send(JSON.stringify({ username: name, text: input.value }));
  input.value = "";
}

window.addEventListener("load", setupWS);
</script>
</html>
